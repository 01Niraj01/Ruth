<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CampusConnect - Interactive Student Job Portal</title>
<style>
  * {
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    margin: 0;
    background: #eef3fb;
    color: #222;
    overflow-x: hidden;
  }
  header {
    background-color: #3f51b5;
    color: white;
    text-align: center;
    padding: 1rem 1rem 0.5rem;
    user-select: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  }
  header h1 {
    margin: 0;
    font-weight: 700;
    font-size: 2.2rem;
  }
  header p {
    margin: 0.2rem 0 1rem 0;
    font-weight: 300;
    font-size: 1.1rem;
  }
  nav {
    background: #283593;
    display: flex;
    justify-content: center;
    gap: 2rem;
    padding: 0.7rem 0;
    user-select: none;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  nav a {
    color: white;
    text-decoration: none;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    padding: 0.4rem 1rem;
    border-radius: 4px;
    transition: all 0.3s;
  }
  nav a:hover, nav a.active {
    background-color: #3949ab;
    transform: translateY(-2px);
  }
  /* Page container */
  .page {
    display: none;
    max-width: 960px;
    margin: 2rem auto 3rem;
    padding: 0 1rem;
    animation: fadeIn 0.5s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .page.active {
    display: block;
  }
  /* Landing page hero */
  #landingPage {
    height: 90vh;
    background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1471&q=80') center/cover no-repeat;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
    font-size: 2.4rem;
    padding: 0 1rem;
    text-align: center;
  }
  #landingPage button {
    margin-top: 2rem;
    padding: 0.8rem 2rem;
    font-size: 1.25rem;
    border: none;
    background-color: #3f51b5;
    border-radius: 6px;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(63,81,181,0.6);
    transition: all 0.3s ease;
    font-weight: 600;
  }
  #landingPage button:hover {
    background-color: #2c387e;
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(63,81,181,0.8);
  }

  /* Forms */
  form {
    background: white;
    padding: 1.5rem 2rem;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    max-width: 480px;
    margin: 1rem auto;
    transition: transform 0.3s ease;
  }
  form:hover {
    transform: translateY(-5px);
  }
  form h3 {
    color: #3f51b5;
    margin-top: 0;
    text-align: center;
  }
  form input[type="text"],
  form input[type="email"],
  form input[type="password"],
  form textarea,
  form select {
    width: 100%;
    padding: 0.8rem;
    margin: 0.6rem 0 1.2rem;
    border: 1.5px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s;
  }
  form input[type="text"]:focus,
  form input[type="email"]:focus,
  form input[type="password"]:focus,
  form textarea:focus,
  form select:focus {
    border-color: #3f51b5;
    outline: none;
  }
  form input[type="submit"],
  button.btn {
    cursor: pointer;
    background-color: #3f51b5;
    color: white;
    border: none;
    padding: 0.8rem 1.8rem;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    width: 100%;
    margin-top: 0.5rem;
  }
  form input[type="submit"]:hover,
  button.btn:hover {
    background-color: #2c387e;
    transform: translateY(-2px);
  }

  /* Cards for job postings and applications */
  .card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 1.8rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    border-left: 4px solid #3f51b5;
  }
  .card:hover {
    transform: translateY(-8px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }
  .card h3 {
    color: #3f51b5;
    margin-bottom: 0.8rem;
    font-size: 1.4rem;
  }
  .card p {
    margin: 0.5rem 0;
    color: #555;
  }
  .card small {
    color: #777;
    font-size: 0.9rem;
  }
  .card .job-meta {
    display: flex;
    gap: 1.5rem;
    margin: 1rem 0;
    flex-wrap: wrap;
  }
  .card .job-meta div {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #555;
  }
  .card .job-meta img {
    width: 18px;
    height: 18px;
    opacity: 0.7;
  }

  /* Job portal links */
  .job-links {
    display: flex;
    gap: 2rem;
    justify-content: center;
    margin: 2rem 0 3rem;
    flex-wrap: wrap;
  }
  .job-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: #3f51b5;
    font-weight: 600;
    font-size: 1rem;
    width: 120px;
    transition: all 0.3s ease;
    padding: 1rem;
    border-radius: 10px;
    background: white;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  }
  .job-link:hover {
    transform: scale(1.1);
    box-shadow: 0 5px 15px rgba(0,0,0,0.12);
    color: #283593;
  }
  .job-link img {
    width: 60px;
    height: 60px;
    object-fit: contain;
    margin-bottom: 0.8rem;
    filter: grayscale(30%);
    transition: filter 0.3s;
  }
  .job-link:hover img {
    filter: grayscale(0);
  }

  /* Application button */
  .apply-btn {
    background-color: #4caf50;
    border: none;
    color: white;
    padding: 0.7rem 1.5rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    margin-top: 1rem;
    display: inline-block;
    font-size: 1rem;
  }
  .apply-btn:hover {
    background-color: #388e3c;
    transform: translateY(-2px);
    box-shadow: 0 3px 10px rgba(76,175,80,0.4);
  }

  /* Status badges */
  .status-badge {
    display: inline-block;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    margin-left: 0.5rem;
  }

  /* Application form popup */
  .modal {
    position: fixed;
    top: 0; left: 0; right:0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    backdrop-filter: blur(3px);
  }
  .modal .modal-content {
    background: white;
    padding: 1.8rem 2.2rem;
    border-radius: 12px;
    width: 380px;
    max-width: 90vw;
    text-align: center;
    position: relative;
    box-shadow: 0 5px 25px rgba(0,0,0,0.2);
    animation: modalFadeIn 0.3s ease;
  }
  @keyframes modalFadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .modal .modal-content h3 {
    margin-bottom: 1.2rem;
    color: #3f51b5;
    font-size: 1.4rem;
  }
  .modal .modal-content input[type="text"],
  .modal .modal-content input[type="email"],
  .modal .modal-content textarea,
  .modal .modal-content input[type="file"] {
    width: 100%;
    margin: 0.7rem 0 1.3rem;
    padding: 0.8rem;
    font-size: 1rem;
    border-radius: 6px;
    border: 1.5px solid #ddd;
  }
  .modal .modal-content textarea {
    min-height: 100px;
    resize: vertical;
  }
  .modal .modal-content button.close-btn {
    position: absolute;
    top: 12px; right: 12px;
    background: #f44336;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 1.3rem;
    width: 32px;
    height: 32px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s;
  }
  .modal .modal-content button.close-btn:hover {
    background: #d32f2f;
  }
  .modal .modal-content button.submit-btn {
    background-color: #3f51b5;
    color: white;
    padding: 0.8rem 1.8rem;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.1rem;
    width: 100%;
  }
  .modal .modal-content button.submit-btn:hover {
    background-color: #2c387e;
    transform: translateY(-2px);
  }

  /* Footer */
  footer {
    background: #3f51b5;
    color: white;
    padding: 1.5rem 1rem;
    text-align: center;
    user-select: none;
    margin-top: 3rem;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
  }
  footer p {
    margin: 0.5rem 0;
  }
  .social-links {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin: 1rem 0;
  }
  .social-links a {
    color: white;
    font-size: 1.5rem;
    transition: transform 0.3s;
  }
  .social-links a:hover {
    transform: translateY(-3px);
  }

  /* Search and filters */
  .search-container {
    margin: 1rem auto 2rem;
    max-width: 600px;
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  #jobSearch {
    width: 100%;
    padding: 0.8rem;
    border-radius: 6px;
    border: 1px solid #ddd;
    font-size: 1rem;
  }
  .filter-options {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
  }
  .filter-options select {
    flex: 1;
    padding: 0.5rem;
    border-radius: 6px;
    border: 1px solid #ddd;
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin: 2rem 0;
  }
  .pagination button {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    background: white;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .pagination button:hover {
    background: #f0f0f0;
  }
  .pagination button.active {
    background: #3f51b5;
    color: white;
    border-color: #3f51b5;
  }

  /* Error/Success messages */
  .alert {
    padding: 0.8rem 1rem;
    border-radius: 6px;
    margin: 1rem auto;
    max-width: 480px;
    text-align: center;
    animation: fadeIn 0.3s ease;
  }
  .alert.error {
    background: #ffebee;
    color: #c62828;
    border-left: 4px solid #c62828;
  }
  .alert.success {
    background: #e8f5e9;
    color: #2e7d32;
    border-left: 4px solid #2e7d32;
  }

  /* Loader */
  #loader {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }
  .loader-content {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    text-align: center;
  }
  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3f51b5;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    nav {
      gap: 1rem;
      padding: 0.7rem 1rem;
      flex-wrap: wrap;
    }
    nav a {
      font-size: 1rem;
      padding: 0.4rem 0.8rem;
    }
    #landingPage {
      font-size: 2rem;
      padding: 0 1.5rem;
    }
    .job-links {
      gap: 1.5rem;
    }
    .job-link {
      width: 100px;
    }
    .card {
      padding: 1.2rem;
    }
    .filter-options {
      flex-direction: column;
    }
  }
  @media (max-width: 480px) {
    nav {
      flex-direction: column;
      gap: 0.5rem;
      padding: 0.5rem;
    }
    .job-links {
      flex-direction: column;
      align-items: center;
    }
    form {
      padding: 1rem;
    }
  }
  input[type="file"] {
    padding: 0.5rem;
    border: 1.5px dashed #ddd;
    background: #f9f9f9;
  }

  input[type="file"]:focus {
    border-color: #3f51b5;
    border-style: solid;
  }

  small {
    font-size: 0.8rem;
    color: #666;
  }

  label {
    display: block;
    margin-bottom: 0.3rem;
    font-weight: 600;
    color: #444;
  }

  label:after {
    content: ' *';
    color: #f44336;
    opacity: 0.8;
  }

  label[for="resumeUpload"]:after {
    content: '';
  }

  /* Job source toggle */
  .search-container label {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
    font-weight: normal;
    color: #444;
  }

  .search-container input[type="radio"] {
    margin: 0;
  }

  /* Accessibility */
  :focus {
    outline: 2px solid #3f51b5;
    outline-offset: 2px;
  }
  [aria-hidden="true"] {
    display: none;
  }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<header>
  <h1>CampusConnect</h1>
  <p id="header-subtext">Student Job Portal</p>
</header>

<!-- Navigation -->
<nav id="mainNav" style="display:none;" aria-label="Main navigation">
  <a href="#" data-page="browse" class="active" aria-current="page">Browse Jobs</a>
  <a href="#" data-page="post">Post Job</a>
  <a href="#" data-page="track">Track Applications</a>
  <a href="#" id="logoutBtn" style="margin-left: auto; color:#ff9e80;">Logout</a>
</nav>

<!-- Pages -->

<!-- Landing page -->
<section id="landingPage" class="page active" style="display:flex;">
  <div>
    <div style="font-weight:700; max-width: 800px; margin: 0 auto; user-select:none; line-height:1.3;">
      Bridging the Gap Between Education and Employment
    </div>
    <p style="font-size:1.2rem; margin-top:1rem; max-width:600px; text-shadow:1px 1px 4px rgba(0,0,0,0.7);">
      Find the perfect job opportunity tailored for students like you
    </p>
    <button onclick="openModal('loginModal')">
      <i class="fas fa-sign-in-alt" style="margin-right:8px;"></i> Login / Signup
    </button>
  </div>
</section>

<!-- Browse Jobs -->
<section id="browse" class="page">
  <h2 style="text-align:center; color:#3f51b5; margin-bottom:1.5rem;">Available Jobs</h2>
  
  <div class="search-container">
    <input type="text" id="jobSearch" placeholder="Search jobs by title, company or location" />
    <div class="filter-options">
      <select id="locationFilter">
        <option value="">All Locations</option>
        <option>Remote</option>
        <option>On Campus</option>
        <option>Hybrid</option>
      </select>
      <select id="typeFilter">
        <option value="">All Types</option>
        <option>Internship</option>
        <option>Part-time</option>
        <option>Full-time</option>
      </select>
    </div>
    <div style="margin-top:1rem; display:flex; justify-content:center; gap:1rem;">
      <label style="cursor:pointer;">
        <input type="radio" name="jobSource" onchange="toggleJobSource(false)" checked>
        Local Jobs
      </label>
      <label style="cursor:pointer;">
        <input type="radio" name="jobSource" onchange="toggleJobSource(true)">
        API Jobs
      </label>
    </div>
  </div>
  
  <div class="job-links" aria-label="Job portals">
    <a href="https://www.adzuna.com" target="_blank" class="job-link" rel="noopener noreferrer" title="Adzuna">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Adzuna_logo.svg/256px-Adzuna_logo.svg.png" alt="Adzuna logo" />
      Adzuna
    </a>
    <a href="https://www.linkedin.com/jobs" target="_blank" class="job-link" rel="noopener noreferrer" title="LinkedIn Jobs">
      <img src="https://cdn-icons-png.flaticon.com/512/174/174857.png" alt="LinkedIn logo" />
      LinkedIn
    </a>
    <a href="https://www.indeed.com" target="_blank" class="job-link" rel="noopener noreferrer" title="Indeed">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Indeed_logo.svg/2560px-Indeed_logo.svg.png" alt="Indeed logo" style="width: 80px;" />
      Indeed
    </a>
    <a href="https://www.glassdoor.com" target="_blank" class="job-link" rel="noopener noreferrer" title="Glassdoor">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Glassdoor_logo_2016.svg/2560px-Glassdoor_logo_2016.svg.png" alt="Glassdoor logo" style="width: 100px;" />
    </a>
  </div>

  <div id="jobsList">
    <!-- Dynamic job postings here -->
  </div>

  <div class="pagination" id="pagination">
    <!-- Pagination buttons will be added here -->
  </div>
</section>

<!-- Post Job -->
<section id="post" class="page">
  <h2 style="text-align:center; color:#3f51b5; margin-bottom:1.5rem;">Post a Job Opportunity</h2>
  <form id="postJobForm">
    <h3><i class="fas fa-briefcase" style="margin-right:10px;"></i>Job Details</h3>
    <label for="jobTitle">Job Title</label>
    <input type="text" id="jobTitle" placeholder="Job Title (e.g., Web Developer Intern)" required aria-required="true" />
    <label for="company">Company Name</label>
    <input type="text" id="company" placeholder="Company Name" required aria-required="true" />
    <label for="location">Location</label>
    <input type="text" id="location" placeholder="Location (e.g., Remote, New York)" required aria-required="true" />
    <label for="jobType">Job Type</label>
    <select id="jobType" required aria-required="true">
      <option value="">Select Job Type</option>
      <option>Internship</option>
      <option>Part-time</option>
      <option>Full-time</option>
    </select>
    <label for="jobDescription">Job Description</label>
    <textarea id="jobDescription" placeholder="Job Description (Responsibilities, Requirements, etc.)" rows="5" required aria-required="true"></textarea>
    <input type="submit" value="Post Job Opportunity" />
  </form>
</section>

<!-- Track Applications -->
<section id="track" class="page">
  <h2 style="text-align:center; color:#3f51b5; margin-bottom:1.5rem;">Your Applications</h2>
  <div id="applicationsList">
    <!-- Dynamic applications here -->
  </div>
</section>

<!-- Login/Signup Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal('loginModal')" aria-label="Close">&times;</button>
    <h3><i class="fas fa-user-circle" style="margin-right:8px;"></i>Login / Signup</h3>
    <label for="emailInput">Email Address</label>
    <input type="email" id="emailInput" placeholder="Email Address" required aria-required="true" />
    <label for="passwordInput">Password</label>
    <input type="password" id="passwordInput" placeholder="Password" required aria-required="true" />
    <div style="margin-top: 1.5rem; display: flex; justify-content: space-between; gap:1rem;">
      <button onclick="loginUser()" class="btn" style="background-color:#3f51b5;"><i class="fas fa-sign-in-alt" style="margin-right:8px;"></i>Login</button>
      <button onclick="signupUser()" class="btn" style="background-color:#4caf50;"><i class="fas fa-user-plus" style="margin-right:8px;"></i>Signup</button>
    </div>
  </div>
</div>

<!-- Apply Modal -->
<div id="applyModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal('applyModal')" aria-label="Close">&times;</button>
    <h3><i class="fas fa-file-alt" style="margin-right:10px;"></i>Apply to Job</h3>
    <p id="applyJobInfo" style="text-align:left; background:#f5f5f5; padding:0.8rem; border-radius:6px; margin-bottom:1.5rem;"></p>
    
    <label for="applicantName">Your Full Name</label>
    <input type="text" id="applicantName" placeholder="Your Full Name" required aria-required="true" />
    
    <label for="applicantEmail">Your Email</label>
    <input type="email" id="applicantEmail" placeholder="Your Email Address" required aria-required="true" />
    
    <label for="resumeUpload">Upload Resume (PDF/DOC)</label>
    <input type="file" id="resumeUpload" accept=".pdf,.doc,.docx" required aria-required="true" />
    <small style="display:block; margin-top:-0.5rem; margin-bottom:1rem; color:#666;">Max file size: 2MB</small>
    
    <label for="applicantMessage">Cover Letter</label>
    <textarea id="applicantMessage" placeholder="Why you're a good fit for this position..." rows="4" required aria-required="true"></textarea>
    
    <button class="submit-btn" onclick="submitApplication()">
      <i class="fas fa-paper-plane" style="margin-right:8px;"></i>Submit Application
    </button>
  </div>
</div>

<!-- Alert Container -->
<div id="alertContainer" style="position: fixed; top: 20px; left: 0; right: 0; z-index: 10000; display: flex; justify-content: center; pointer-events: none;"></div>

<!-- Loader -->
<div id="loader">
  <div class="loader-content">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>
</div>

<footer id="footer" style="display:none;">
  <div style="max-width:800px; margin:0 auto;">
    <p style="font-size:1.2rem; font-weight:600;">CampusConnect</p>
    <p>Connecting students with meaningful employment opportunities</p>
    <div class="social-links">
      <a href="#" title="Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Facebook</span></a>
      <a href="#" title="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Twitter</span></a>
      <a href="#" title="LinkedIn"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="sr-only">LinkedIn</span></a>
      <a href="#" title="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i><span class="sr-only">Instagram</span></a>
    </div>
    <p>&copy; 2025 CampusConnect | All rights reserved.</p>
  </div>
</footer>

<script>
  // --- State Management Object ---
  const state = {
    currentUser: null,
    jobs: [],
    applications: [],
    filteredJobs: [],
    currentPage: 1,
    jobsPerPage: 5,
    applyingJobId: null,
    users: {},
    useAPI: false, // Flag to toggle between local and API jobs

    init() {
      this.currentUser = localStorage.getItem('currentUser');
      this.jobs = JSON.parse(localStorage.getItem('jobs')) || [];
      this.applications = JSON.parse(localStorage.getItem('applications')) || [];
      this.users = JSON.parse(localStorage.getItem('users')) || {};

      // Initialize with sample jobs if empty
      if (this.jobs.length === 0) {
        this.jobs = [
          { 
            id: '1', 
            title: 'Campus Ambassador', 
            company: 'TechStart Inc.', 
            location: 'Remote', 
            type: 'Part-time', 
            description: 'Represent TechStart on campus and help promote our products to fellow students. Responsibilities include organizing events, social media promotion, and gathering feedback.', 
            postedBy: 'admin@campus.edu', 
            postedDate: new Date().toISOString(),
            isExternal: false
          },
          { 
            id: '2', 
            title: 'Research Assistant', 
            company: 'University Labs', 
            location: 'On Campus', 
            type: 'Part-time', 
            description: 'Assist professors with academic research projects. Requires strong organizational skills and attention to detail. Flexible hours available.', 
            postedBy: 'professor@university.edu', 
            postedDate: new Date(Date.now() - 86400000 * 2).toISOString(),
            isExternal: false
          },
          { 
            id: '3', 
            title: 'Web Developer Intern', 
            company: 'Digital Solutions', 
            location: 'Downtown Office (Hybrid)', 
            type: 'Internship', 
            description: 'Summer internship for computer science students. Work on real client projects using modern web technologies. Mentorship provided.', 
            postedBy: 'hr@digitalsolutions.com', 
            postedDate: new Date(Date.now() - 86400000 * 5).toISOString(),
            isExternal: false
          }
        ];
      }

      // Initialize with sample application if user exists
      if (this.applications.length === 0 && this.currentUser) {
        this.applications = [{
          id: '1',
          jobId: '1',
          jobTitle: 'Campus Ambassador',
          company: 'TechStart Inc.',
          applicantName: this.currentUser.split('@')[0],
          applicantEmail: this.currentUser,
          coverLetter: 'I would love to represent TechStart on campus as I have experience with event organization and social media marketing.',
          status: 'Under Review',
          date: new Date(Date.now() - 86400000 * 3).toISOString()
        }];
      }

      this.filteredJobs = [...this.jobs];
      this.save();
    },

    save() {
      localStorage.setItem('jobs', JSON.stringify(this.jobs));
      localStorage.setItem('applications', JSON.stringify(this.applications));
      localStorage.setItem('users', JSON.stringify(this.users));
      if (this.currentUser) {
        localStorage.setItem('currentUser', this.currentUser);
      } else {
        localStorage.removeItem('currentUser');
      }
    },

    hashPassword(p) {
      let hash = 0;
      for (let i = 0; i < p.length; i++) {
        hash = (hash << 5) - hash + p.charCodeAt(i);
        hash &= hash; // Convert to 32bit integer
      }
      return hash.toString(36);
    },

    isValidEmail(email) { 
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); 
    },
    
    isValidPassword(password) { 
      return password.length >= 6; 
    },

    filterJobs(search = '', location = '', type = '') {
      this.filteredJobs = this.jobs.filter(job => {
        const matchSearch = search === '' || 
          job.title.toLowerCase().includes(search.toLowerCase()) || 
          job.company.toLowerCase().includes(search.toLowerCase()) || 
          job.location.toLowerCase().includes(search.toLowerCase());
        
        const matchLoc = location === '' || 
          job.location.toLowerCase().includes(location.toLowerCase());
        
        const matchType = type === '' || 
          (job.type && job.type.toLowerCase() === type.toLowerCase());
        
        return matchSearch && matchLoc && matchType;
      });
      this.currentPage = 1;
    },

    getPaginatedJobs() {
      const start = (this.currentPage - 1) * this.jobsPerPage;
      return this.filteredJobs.slice(start, start + this.jobsPerPage);
    },

    getTotalPages() {
      return Math.ceil(this.filteredJobs.length / this.jobsPerPage);
    },

    async fetchJobsFromAPI(query = 'student', location = '') {
      showLoader(true);
      try {
        const response = await fetch(
          `https://jsearch.p.rapidapi.com/search?query=${encodeURIComponent(query)}%20student%20job&num_pages=1&location=${encodeURIComponent(location)}`,
          {
            method: 'GET',
            headers: {
              'X-RapidAPI-Key': '7c9d418be4msh5cfae30c115844cp1f3581jsn5899bc44c5e9',
              'X-RapidAPI-Host': 'jsearch.p.rapidapi.com'
            }
          }
        );
        
        if (!response.ok) {
          throw new Error(`API request failed with status ${response.status}`);
        }
        
        const data = await response.json();
        
        // Check if data exists and has the expected structure
        if (!data || !data.data || !Array.isArray(data.data)) {
          throw new Error('Invalid API response structure');
        }
        
        // Convert API jobs to our format with proper null checks
        const apiJobs = data.data.map(job => ({
          id: job.job_id || `api-${Math.random().toString(36).substr(2, 9)}`,
          title: job.job_title || 'No title available',
          company: job.employer_name || 'Company not specified',
          location: [
            job.job_city || '',
            job.job_country || ''
          ].filter(Boolean).join(', ') || 'Location not specified',
          type: job.job_employment_type || 'Not specified',
          description: job.job_description || 'No description available',
          postedDate: job.job_posted_at_timestamp 
            ? new Date(job.job_posted_at_timestamp * 1000).toISOString()
            : new Date().toISOString(),
          isExternal: true,
          applyLink: job.job_apply_link || '#'
        }));
        
        // Merge with existing jobs
        this.jobs = [...apiJobs, ...this.jobs.filter(j => !j.isExternal)];
        this.filterJobs();
        this.save();
        return true;
      } catch (error) {
        console.error('API Error:', error);
        showAlert('Failed to fetch jobs from API. Showing local listings instead.', 'error');
        return false;
      } finally {
        showLoader(false);
      }
    }
  };

  // --- Utility Functions ---
  function showLoader(show = true) {
    document.getElementById('loader').style.display = show ? 'flex' : 'none';
  }

  function showAlert(message, type = 'success', duration = 5000) {
    const alertEl = document.createElement('div');
    alertEl.className = `alert ${type}`;
    alertEl.textContent = message;
    document.getElementById('alertContainer').appendChild(alertEl);
    setTimeout(() => alertEl.remove(), duration);
  }

  function openModal(modalId) {
    document.getElementById(modalId).style.display = 'flex';
    document.querySelector(`#${modalId} input`).focus();
  }

  function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
  }

  // --- Core Application Functions ---
  function renderJobs() {
    const jobsList = document.getElementById('jobsList');
    jobsList.innerHTML = '';

    const jobs = state.getPaginatedJobs();
    if (jobs.length === 0) {
      jobsList.innerHTML = '<div class="card"><p style="text-align:center;">No jobs found matching your criteria.</p></div>';
      return;
    }

    jobs.forEach(job => {
      const card = document.createElement('div');
      card.className = 'card';
      
      if (job.isExternal) {
        // External job from API
        card.innerHTML = `
          <h3>${job.title}</h3>
          <p><strong>${job.company}</strong> • ${job.location} • ${job.type}</p>
          <p>${job.description.slice(0, 200)}${job.description.length > 200 ? '...' : ''}</p>
          <small>Posted: ${new Date(job.postedDate).toLocaleDateString()}</small><br>
          <a href="${job.applyLink}" target="_blank" rel="noopener noreferrer" class="apply-btn">
            Apply on ${job.company}
          </a>
        `;
      } else {
        // Local job posting
        card.innerHTML = `
          <h3>${job.title}</h3>
          <p><strong>${job.company}</strong> • ${job.location} • ${job.type}</p>
          <p>${job.description}</p>
          <small>Posted on: ${new Date(job.postedDate).toLocaleDateString()}</small><br>
          <button class="apply-btn" onclick="openApplyModal('${job.id}')">
            Apply Now
          </button>
        `;
      }
      
      jobsList.appendChild(card);
    });

    renderPagination();
  }

  function renderPagination() {
    const totalPages = state.getTotalPages();
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    if (totalPages <= 1) return;

    // Previous button
    const prevBtn = document.createElement('button');
    prevBtn.innerHTML = '&laquo;';
    prevBtn.disabled = state.currentPage === 1;
    prevBtn.addEventListener('click', () => {
      if (state.currentPage > 1) {
        state.currentPage--;
        renderJobs();
      }
    });
    pagination.appendChild(prevBtn);

    // Page buttons
    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.className = i === state.currentPage ? 'active' : '';
      btn.addEventListener('click', () => {
        state.currentPage = i;
        renderJobs();
      });
      pagination.appendChild(btn);
    }

    // Next button
    const nextBtn = document.createElement('button');
    nextBtn.innerHTML = '&raquo;';
    nextBtn.disabled = state.currentPage === totalPages;
    nextBtn.addEventListener('click', () => {
      if (state.currentPage < totalPages) {
        state.currentPage++;
        renderJobs();
      }
    });
    pagination.appendChild(nextBtn);
  }

  function renderApplications() {
    const container = document.getElementById('applicationsList');
    container.innerHTML = '';

    const apps = state.applications.filter(app => app.applicantEmail === state.currentUser);
    if (apps.length === 0) {
      container.innerHTML = '<div class="card"><p style="text-align:center;">No applications submitted yet.</p></div>';
      return;
    }

    apps.forEach(app => {
      const job = state.jobs.find(j => j.id === app.jobId) || {};
      const card = document.createElement('div');
      card.className = 'card';
      
      let statusClass = '';
      if (app.status === 'Accepted') statusClass = 'background:#4caf50; color:white;';
      else if (app.status === 'Rejected') statusClass = 'background:#f44336; color:white;';
      else statusClass = 'background:#e0e0e0;';
      
      card.innerHTML = `
        <h3>${app.jobTitle}</h3>
        <p><strong>${app.company}</strong></p>
        <div class="job-meta">
          <div>
            <i class="fas fa-calendar-alt"></i>
            <span>Applied: ${new Date(app.date).toLocaleDateString()}</span>
          </div>
          <div>
            <i class="fas fa-info-circle"></i>
            <span>Status: <span class="status-badge" style="${statusClass}">${app.status}</span></span>
          </div>
        </div>
        ${job.description ? `<p>${job.description.slice(0, 100)}...</p>` : ''}
        <button onclick="viewApplicationDetails('${app.id}')" class="apply-btn" style="background:#3f51b5;">
          View Details
        </button>
      `;
      container.appendChild(card);
    });
  }

  function viewApplicationDetails(appId) {
    const app = state.applications.find(a => a.id === appId);
    if (!app) return showAlert('Application not found', 'error');
    
    const job = state.jobs.find(j => j.id === app.jobId) || {};
    
    let statusClass = '';
    if (app.status === 'Accepted') statusClass = 'background:#4caf50; color:white;';
    else if (app.status === 'Rejected') statusClass = 'background:#f44336; color:white;';
    else statusClass = 'background:#e0e0e0;';
    
    const modalContent = `
      <button class="close-btn" onclick="closeModal('appDetailsModal')" aria-label="Close">&times;</button>
      <h3><i class="fas fa-file-alt"></i> Application Details</h3>
      
      <div style="text-align:left; background:#f5f5f5; padding:1rem; border-radius:6px; margin-bottom:1.5rem;">
        <h4 style="margin-top:0;">${app.jobTitle}</h4>
        <p><strong>${app.company}</strong></p>
        <p>Status: <span class="status-badge" style="${statusClass}">${app.status}</span></p>
        <p>Applied on: ${new Date(app.date).toLocaleDateString()}</p>
      </div>
      
      <h4 style="text-align:left; margin-bottom:0.5rem;">Your Cover Letter:</h4>
      <div style="text-align:left; background:white; border:1px solid #eee; padding:1rem; border-radius:6px; margin-bottom:1.5rem;">
        ${app.coverLetter}
      </div>
      
      ${job.description ? `
      <h4 style="text-align:left; margin-bottom:0.5rem;">Job Description:</h4>
      <div style="text-align:left; background:white; border:1px solid #eee; padding:1rem; border-radius:6px; margin-bottom:1.5rem;">
        ${job.description}
      </div>
      ` : ''}
      
      <button class="submit-btn" onclick="closeModal('appDetailsModal')">
        <i class="fas fa-times"></i> Close
      </button>
    `;
    
    // Create or update modal
    let modal = document.getElementById('appDetailsModal');
    if (!modal) {
      modal = document.createElement('div');
      modal.id = 'appDetailsModal';
      modal.className = 'modal';
      modal.innerHTML = `<div class="modal-content">${modalContent}</div>`;
      document.body.appendChild(modal);
    } else {
      modal.innerHTML = `<div class="modal-content">${modalContent}</div>`;
    }
    
    openModal('appDetailsModal');
  }

  function openApplyModal(jobId) {
    if (!state.currentUser) {
      showAlert('Please login to apply for jobs.', 'error');
      openModal('loginModal');
      return;
    }
    
    const job = state.jobs.find(j => j.id === jobId);
    if (!job) {
      showAlert('Job not found', 'error');
      return;
    }

    state.applyingJobId = jobId;
    document.getElementById('applyJobInfo').innerHTML = `
      <strong>${job.title}</strong><br>
      ${job.company} • ${job.location}<br>
      Type: ${job.type}
    `;

    // Pre-fill user info if available
    const user = state.users[state.currentUser];
    if (user) {
      document.getElementById('applicantName').value = user.name || state.currentUser.split('@')[0];
      document.getElementById('applicantEmail').value = state.currentUser;
    }

    // Clear previous inputs
    document.getElementById('resumeUpload').value = '';
    document.getElementById('applicantMessage').value = '';

    openModal('applyModal');
  }

  function submitApplication() {
    const name = document.getElementById('applicantName').value.trim();
    const email = document.getElementById('applicantEmail').value.trim();
    const resume = document.getElementById('resumeUpload').files[0];
    const cover = document.getElementById('applicantMessage').value.trim();
    const jobId = state.applyingJobId;

    // Validation
    if (!name || !email || !cover || !resume) {
      showAlert('Please fill all required fields', 'error');
      return;
    }

    // Validate email format
    if (!state.isValidEmail(email)) {
      showAlert('Please enter a valid email address', 'error');
      return;
    }

    // Validate resume file
    const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
    if (!allowedTypes.includes(resume.type)) {
      showAlert('Please upload a PDF or Word document', 'error');
      return;
    }

    if (resume.size > 2 * 1024 * 1024) {
      showAlert('File size should be less than 2MB', 'error');
      return;
    }

    showLoader(true);
    
    // Simulate processing delay
    setTimeout(() => {
      const job = state.jobs.find(j => j.id === jobId);
      if (!job) {
        showLoader(false);
        showAlert('Job not found', 'error');
        return;
      }

      // Create new application
      const newApp = {
        id: Date.now().toString(),
        jobId,
        jobTitle: job.title,
        company: job.company,
        applicantName: name,
        applicantEmail: email,
        resumeFileName: resume.name,
        coverLetter: cover,
        status: 'Under Review',
        date: new Date().toISOString()
      };

      state.applications.unshift(newApp);
      state.save();

      showLoader(false);
      closeModal('applyModal');
      showAlert('Application submitted successfully!', 'success');
      renderApplications();
    }, 1500);
  }

  function postJob() {
    const title = document.getElementById('jobTitle').value.trim();
    const company = document.getElementById('company').value.trim();
    const location = document.getElementById('location').value.trim();
    const type = document.getElementById('jobType').value.trim();
    const description = document.getElementById('jobDescription').value.trim();

    // Validate all fields
    if (!title || !company || !location || !type || !description) {
      showAlert('Please fill in all fields', 'error');
      return;
    }

    // Create new job
    const newJob = {
      id: Date.now().toString(),
      title,
      company,
      location,
      type,
      description,
      postedBy: state.currentUser,
      postedDate: new Date().toISOString(),
      isExternal: false
    };

    state.jobs.unshift(newJob);
    state.filterJobs();
    state.save();

    // Reset form
    document.getElementById('postJobForm').reset();
    
    showAlert('Job posted successfully!', 'success');
    showPage('browse');
    renderJobs();
  }

  function loginUser() {
    const email = document.getElementById('emailInput').value.trim();
    const password = document.getElementById('passwordInput').value.trim();

    if (!state.isValidEmail(email)) {
      showAlert('Please enter a valid email address', 'error');
      return;
    }

    if (!state.isValidPassword(password)) {
      showAlert('Password must be at least 6 characters', 'error');
      return;
    }

    const user = state.users[email];
    if (!user || user.passwordHash !== state.hashPassword(password)) {
      showAlert('Invalid email or password', 'error');
      return;
    }

    state.currentUser = email;
    state.save();
    closeModal('loginModal');
    onLogin();
    showAlert(`Welcome back, ${user.name || email.split('@')[0]}!`, 'success');
  }

  function signupUser() {
    const email = document.getElementById('emailInput').value.trim();
    const password = document.getElementById('passwordInput').value.trim();

    if (!state.isValidEmail(email)) {
      showAlert('Please enter a valid email address', 'error');
      return;
    }

    if (!state.isValidPassword(password)) {
      showAlert('Password must be at least 6 characters', 'error');
      return;
    }

    if (state.users[email]) {
      showAlert('Email already registered. Please login instead.', 'error');
      return;
    }

    // Create new user
    state.users[email] = {
      email,
      passwordHash: state.hashPassword(password),
      name: email.split('@')[0]
    };

    state.currentUser = email;
    state.save();
    closeModal('loginModal');
    onLogin();
    showAlert(`Account created successfully! Welcome, ${state.users[email].name}!`, 'success');
  }

  function logoutUser() {
    if (!confirm('Are you sure you want to logout?')) return;
    
    state.currentUser = null;
    state.save();
    
    document.getElementById('landingPage').style.display = 'flex';
    document.getElementById('mainNav').style.display = 'none';
    document.getElementById('footer').style.display = 'none';
    document.getElementById('header-subtext').textContent = 'Student Job Portal';
    showPage('landingPage');
    showAlert('Logged out successfully', 'success');
  }

  function onLogin() {
    document.getElementById('landingPage').style.display = 'none';
    document.getElementById('mainNav').style.display = 'flex';
    document.getElementById('footer').style.display = 'block';
    
    const userName = state.users[state.currentUser]?.name || state.currentUser.split('@')[0];
    document.getElementById('header-subtext').textContent = `Welcome, ${userName}`;
    
    showPage('browse');
    renderJobs();
    renderApplications();
  }

  function showPage(pageId) {
    // Hide all pages
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    // Show selected page
    document.getElementById(pageId).classList.add('active');
    
    // Update nav links
    document.querySelectorAll('nav a[data-page]').forEach(a => {
      a.classList.toggle('active', a.dataset.page === pageId);
      a.setAttribute('aria-current', a.dataset.page === pageId ? 'page' : 'false');
    });
    
    // Special handling for certain pages
    if (pageId === 'browse') {
      renderJobs();
    } else if (pageId === 'track') {
      renderApplications();
    }
  }

  function handleJobSearch() {
    const search = document.getElementById('jobSearch').value;
    const location = document.getElementById('locationFilter').value;
    const type = document.getElementById('typeFilter').value;
    
    if (state.useAPI) {
      // Use API search
      const query = search || 'student';
      state.fetchJobsFromAPI(query, location).then(success => {
        if (success) {
          state.filterJobs(search, location, type);
          renderJobs();
        }
      });
    } else {
      // Use local search
      state.filterJobs(search, location, type);
      renderJobs();
    }
  }

  function toggleJobSource(useAPI) {
    state.useAPI = useAPI;
    state.currentPage = 1;
    handleJobSearch();
  }

  // --- Initialize Application ---
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize state
    state.init();
    
    // Set up event listeners
    document.querySelectorAll('nav a[data-page]').forEach(a => {
      a.addEventListener('click', e => {
        e.preventDefault();
        showPage(a.dataset.page);
      });
    });
    
    document.getElementById('logoutBtn').addEventListener('click', e => {
      e.preventDefault();
      logoutUser();
    });
    
    document.getElementById('postJobForm').addEventListener('submit', e => {
      e.preventDefault();
      postJob();
    });
    
    // Search and filter handlers
    document.getElementById('jobSearch').addEventListener('input', handleJobSearch);
    document.getElementById('locationFilter').addEventListener('change', handleJobSearch);
    document.getElementById('typeFilter').addEventListener('change', handleJobSearch);
    
    // Check if user is already logged in
    if (state.currentUser) {
      onLogin();
    }
  });
</script>
</body>
</html>
